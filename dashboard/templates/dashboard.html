<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FANET Honeydrone Testbed - Dashboard</title>
    
    <!-- CSS Libraries -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
    
    <!-- Custom CSS -->
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --info-color: #17a2b8;
            --dark-color: #343a40;
            --light-color: #f8f9fa;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
        }

        .navbar {
            background: rgba(44, 62, 80, 0.95) !important;
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .navbar-brand {
            font-weight: bold;
            font-size: 1.5rem;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        .status-indicator.online { background-color: var(--success-color); }
        .status-indicator.offline { background-color: var(--danger-color); }
        .status-indicator.warning { background-color: var(--warning-color); }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .dashboard-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: none;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            margin-bottom: 2rem;
            transition: all 0.3s ease;
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 45px rgba(31, 38, 135, 0.5);
        }

        .card-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            border-radius: 15px 15px 0 0 !important;
            padding: 1rem 1.5rem;
        }

        .metric-card {
            text-align: center;
            padding: 2rem 1rem;
            border-radius: 15px;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }

        .metric-card:hover {
            transform: scale(1.05);
        }

        .metric-card.success { background: linear-gradient(135deg, var(--success-color), #2ecc71); }
        .metric-card.danger { background: linear-gradient(135deg, var(--danger-color), #c0392b); }
        .metric-card.warning { background: linear-gradient(135deg, var(--warning-color), #e67e22); }
        .metric-card.info { background: linear-gradient(135deg, var(--info-color), #3498db); }

        .metric-card h3 {
            color: white;
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .metric-card p {
            color: rgba(255, 255, 255, 0.9);
            margin: 0;
            font-weight: 500;
        }

        .control-panel {
            background: rgba(52, 58, 64, 0.95);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .control-panel .btn {
            margin: 0.25rem;
            border-radius: 10px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .control-panel .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .chart-container {
            height: 400px;
            width: 100%;
        }

        .log-container {
            background: #1e1e1e;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            padding: 1rem;
            border-radius: 10px;
            height: 300px;
            overflow-y: auto;
            border: 1px solid #333;
        }

        .log-entry {
            padding: 0.25rem 0;
            border-bottom: 1px solid #333;
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        .timestamp {
            color: #888;
            margin-right: 1rem;
        }

        .loading-spinner {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
        }

        .connection-status {
            position: fixed;
            top: 70px;
            right: 20px;
            z-index: 1000;
            padding: 0.5rem 1rem;
            border-radius: 10px;
            font-weight: 500;
        }

        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1050;
        }

        .network-node {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .network-node:hover {
            transform: scale(1.2);
        }

        .threat-alert {
            animation: flash 1s infinite;
        }

        @keyframes flash {
            0%, 50%, 100% { opacity: 1; }
            25%, 75% { opacity: 0.5; }
        }

        .sidebar {
            background: rgba(52, 58, 64, 0.95);
            backdrop-filter: blur(10px);
            min-height: calc(100vh - 76px);
            padding: 1rem 0;
        }

        .sidebar .nav-link {
            color: rgba(255, 255, 255, 0.8);
            padding: 0.75rem 1.5rem;
            border-radius: 0;
            transition: all 0.3s ease;
        }

        .sidebar .nav-link:hover,
        .sidebar .nav-link.active {
            background: var(--secondary-color);
            color: white;
        }

        .main-content {
            padding: 2rem;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 1rem;
            }
            
            .metric-card h3 {
                font-size: 2rem;
            }
            
            .chart-container {
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fas fa-shield-alt me-2"></i>
                FANET Honeydrone Testbed
            </a>
            
            <div class="d-flex align-items-center">
                <span class="me-3">
                    <span id="connection-indicator" class="status-indicator offline"></span>
                    <span id="connection-text">Disconnected</span>
                </span>
                
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Connection Status Toast -->
    <div class="toast-container">
        <div id="connection-toast" class="toast" role="alert">
            <div class="toast-header">
                <i class="fas fa-wifi me-2"></i>
                <strong class="me-auto">Connection Status</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body" id="connection-toast-body">
                Connection status changed
            </div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div class="loading-spinner">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-2 sidebar">
                <ul class="nav nav-pills flex-column">
                    <li class="nav-item">
                        <a class="nav-link active" href="#overview" data-tab="overview">
                            <i class="fas fa-tachometer-alt me-2"></i>Overview
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#network" data-tab="network">
                            <i class="fas fa-network-wired me-2"></i>Network
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#threats" data-tab="threats">
                            <i class="fas fa-exclamation-triangle me-2"></i>Threats
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#mtd" data-tab="mtd">
                            <i class="fas fa-shield-alt me-2"></i>MTD Actions
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#control" data-tab="control">
                            <i class="fas fa-cogs me-2"></i>Control
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#logs" data-tab="logs">
                            <i class="fas fa-file-alt me-2"></i>Logs
                        </a>
                    </li>
                </ul>
            </div>

            <!-- Main Content -->
            <div class="col-md-10 main-content">
                <!-- Overview Tab -->
                <div id="overview-tab" class="tab-content active">
                    <!-- Metrics Row -->
                    <div class="row mb-4">
                        <div class="col-lg-3 col-md-6">
                            <div class="metric-card info">
                                <h3 id="total-nodes">0</h3>
                                <p><i class="fas fa-broadcast-tower me-2"></i>Total Nodes</p>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6">
                            <div class="metric-card danger">
                                <h3 id="compromised-nodes">0</h3>
                                <p><i class="fas fa-virus me-2"></i>Compromised</p>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6">
                            <div class="metric-card warning">
                                <h3 id="total-threats">0</h3>
                                <p><i class="fas fa-exclamation-triangle me-2"></i>Threats</p>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6">
                            <div class="metric-card success">
                                <h3 id="mtd-actions">0</h3>
                                <p><i class="fas fa-shield-alt me-2"></i>MTD Actions</p>
                            </div>
                        </div>
                    </div>

                    <!-- Charts Row -->
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="dashboard-card">
                                <div class="card-header">
                                    <h5 class="mb-0"><i class="fas fa-heart me-2"></i>Network Health</h5>
                                </div>
                                <div class="card-body">
                                    <div id="network-health-chart" class="chart-container"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="dashboard-card">
                                <div class="card-header">
                                    <h5 class="mb-0"><i class="fas fa-chart-line me-2"></i>Threat Timeline</h5>
                                </div>
                                <div class="card-body">
                                    <div id="threat-timeline-chart" class="chart-container"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-6">
                            <div class="dashboard-card">
                                <div class="card-header">
                                    <h5 class="mb-0"><i class="fas fa-bolt me-2"></i>Energy Levels</h5>
                                </div>
                                <div class="card-body">
                                    <div id="energy-levels-chart" class="chart-container"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="dashboard-card">
                                <div class="card-header">
                                    <h5 class="mb-0"><i class="fas fa-crosshairs me-2"></i>MTD Effectiveness</h5>
                                </div>
                                <div class="card-body">
                                    <div id="mtd-effectiveness-chart" class="chart-container"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Network Tab -->
                <div id="network-tab" class="tab-content">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h5 class="mb-0"><i class="fas fa-project-diagram me-2"></i>3D Network Topology</h5>
                        </div>
                        <div class="card-body">
                            <div id="network-topology-chart" class="chart-container" style="height: 600px;"></div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-6">
                            <div class="dashboard-card">
                                <div class="card-header">
                                    <h5 class="mb-0"><i class="fas fa-list me-2"></i>Node Status</h5>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-striped" id="nodes-table">
                                            <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Type</th>
                                                    <th>Status</th>
                                                    <th>Energy</th>
                                                    <th>Position</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- Populated by JavaScript -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="dashboard-card">
                                <div class="card-header">
                                    <h5 class="mb-0"><i class="fas fa-signal me-2"></i>Network Statistics</h5>
                                </div>
                                <div class="card-body">
                                    <div id="network-stats">
                                        <div class="row">
                                            <div class="col-6">
                                                <div class="stat-item">
                                                    <h6>Packet Delivery Ratio</h6>
                                                    <div class="progress mb-2">
                                                        <div id="pdr-progress" class="progress-bar bg-success" style="width: 0%"></div>
                                                    </div>
                                                    <small id="pdr-text">0%</small>
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <div class="stat-item">
                                                    <h6>Network Throughput</h6>
                                                    <div class="progress mb-2">
                                                        <div id="throughput-progress" class="progress-bar bg-info" style="width: 0%"></div>
                                                    </div>
                                                    <small id="throughput-text">0 kbps</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row mt-3">
                                            <div class="col-6">
                                                <h6>Average Latency</h6>
                                                <span id="latency-text" class="badge bg-primary">0 ms</span>
                                            </div>
                                            <div class="col-6">
                                                <h6>Active Connections</h6>
                                                <span id="connections-text" class="badge bg-success">0</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Threats Tab -->
                <div id="threats-tab" class="tab-content">
                    <div class="row">
                        <div class="col-lg-8">
                            <div class="dashboard-card">
                                <div class="card-header">
                                    <h5 class="mb-0"><i class="fas fa-exclamation-triangle me-2"></i>Active Threats</h5>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-striped" id="threats-table">
                                            <thead>
                                                <tr>
                                                    <th>Time</th>
                                                    <th>Type</th>
                                                    <th>Source</th>
                                                    <th>Target</th>
                                                    <th>Severity</th>
                                                    <th>Status</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- Populated by JavaScript -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="dashboard-card">
                                <div class="card-header">
                                    <h5 class="mb-0"><i class="fas fa-chart-pie me-2"></i>Threat Distribution</h5>
                                </div>
                                <div class="card-body">
                                    <div id="threat-distribution-chart" class="chart-container"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="dashboard-card">
                        <div class="card-header">
                            <h5 class="mb-0"><i class="fas fa-map me-2"></i>Threat Heatmap</h5>
                        </div>
                        <div class="card-body">
                            <div id="threat-heatmap-chart" class="chart-container"></div>
                        </div>
                    </div>
                </div>

                <!-- MTD Tab -->
                <div id="mtd-tab" class="tab-content">
                    <div class="row">
                        <div class="col-lg-8">
                            <div class="dashboard-card">
                                <div class="card-header">
                                    <h5 class="mb-0"><i class="fas fa-shield-alt me-2"></i>MTD Actions History</h5>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-striped" id="mtd-table">
                                            <thead>
                                                <tr>
                                                    <th>Time</th>
                                                    <th>Action</th>
                                                    <th>Target Nodes</th>
                                                    <th>Effectiveness</th>
                                                    <th>Cost</th>
                                                    <th>Status</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- Populated by JavaScript -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="dashboard-card">
                                <div class="card-header">
                                    <h5 class="mb-0"><i class="fas fa-chart-bar me-2"></i>MTD Performance</h5>
                                </div>
                                <div class="card-body">
                                    <div id="mtd-performance-chart" class="chart-container"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Control Tab -->
                <div id="control-tab" class="tab-content">
                    <div class="control-panel">
                        <h5 class="text-white mb-3"><i class="fas fa-cogs me-2"></i>Simulation Control</h5>
                        
                        <div class="row">
                            <div class="col-lg-6">
                                <h6 class="text-white-50 mb-3">Simulation Management</h6>
                                <button id="start-sim-btn" class="btn btn-success">
                                    <i class="fas fa-play me-2"></i>Start Simulation
                                </button>
                                <button id="stop-sim-btn" class="btn btn-danger">
                                    <i class="fas fa-stop me-2"></i>Stop Simulation
                                </button>
                                <button id="pause-sim-btn" class="btn btn-warning">
                                    <i class="fas fa-pause me-2"></i>Pause Simulation
                                </button>
                                <button id="export-results-btn" class="btn btn-info">
                                    <i class="fas fa-download me-2"></i>Export Results
                                </button>
                            </div>
                            <div class="col-lg-6">
                                <h6 class="text-white-50 mb-3">Testing & Analysis</h6>
                                <button id="inject-threat-btn" class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#threatModal">
                                    <i class="fas fa-bug me-2"></i>Inject Threat
                                </button>
                                <button id="trigger-mtd-btn" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#mtdModal">
                                    <i class="fas fa-shield-alt me-2"></i>Trigger MTD
                                </button>
                                <button id="reset-network-btn" class="btn btn-secondary">
                                    <i class="fas fa-redo me-2"></i>Reset Network
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Simulation Parameters -->
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h5 class="mb-0"><i class="fas fa-sliders-h me-2"></i>Simulation Parameters</h5>
                        </div>
                        <div class="card-body">
                            <form id="sim-params-form">
                                <div class="row">
                                    <div class="col-lg-3">
                                        <label for="duration" class="form-label">Duration (seconds)</label>
                                        <input type="number" class="form-control" id="duration" value="300" min="10" max="3600">
                                    </div>
                                    <div class="col-lg-3">
                                        <label for="drones" class="form-label">Number of Drones</label>
                                        <input type="number" class="form-control" id="drones" value="10" min="1" max="50">
                                    </div>
                                    <div class="col-lg-3">
                                        <label for="honeypots" class="form-label">Number of Honeypots</label>
                                        <input type="number" class="form-control" id="honeypots" value="5" min="1" max="20">
                                    </div>
                                    <div class="col-lg-3">
                                        <label for="attack-scenario" class="form-label">Attack Scenario</label>
                                        <select class="form-select" id="attack-scenario">
                                            <option value="none">None</option>
                                            <option value="jamming">Jamming</option>
                                            <option value="spoofing">Spoofing</option>
                                            <option value="mixed" selected>Mixed</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row mt-3">
                                    <div class="col-lg-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="enable-mtd" checked>
                                            <label class="form-check-label" for="enable-mtd">
                                                Enable MTD
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-lg-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="enable-logging" checked>
                                            <label class="form-check-label" for="enable-logging">
                                                Enable Detailed Logging
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-lg-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="enable-animation">
                                            <label class="form-check-label" for="enable-animation">
                                                Enable Animation
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Logs Tab -->
                <div id="logs-tab" class="tab-content">
                    <div class="dashboard-card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0"><i class="fas fa-file-alt me-2"></i>System Logs</h5>
                            <div>
                                <button id="clear-logs-btn" class="btn btn-sm btn-outline-danger">
                                    <i class="fas fa-trash me-1"></i>Clear
                                </button>
                                <button id="download-logs-btn" class="btn btn-sm btn-outline-primary">
                                    <i class="fas fa-download me-1"></i>Download
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="log-container" id="log-container">
                                <div class="log-entry">
                                    <span class="timestamp">[2023-12-07 10:00:00]</span>
                                    <span class="log-message">Dashboard initialized</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Threat Injection Modal -->
    <div class="modal fade" id="threatModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-bug me-2"></i>Inject Threat</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="threat-form">
                        <div class="mb-3">
                            <label for="threat-type" class="form-label">Threat Type</label>
                            <select class="form-select" id="threat-type" required>
                                <option value="jamming">Jamming</option>
                                <option value="spoofing">Spoofing</option>
                                <option value="dos">DoS Attack</option>
                                <option value="eavesdropping">Eavesdropping</option>
                                <option value="mitm">Man-in-the-Middle</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="source-node" class="form-label">Source Node ID</label>
                            <input type="number" class="form-control" id="source-node" min="0" required>
                        </div>
                        <div class="mb-3">
                            <label for="target-node" class="form-label">Target Node ID</label>
                            <input type="number" class="form-control" id="target-node" min="0" required>
                        </div>
                        <div class="mb-3">
                            <label for="threat-severity" class="form-label">Severity (0.0 - 1.0)</label>
                            <input type="range" class="form-range" id="threat-severity" min="0" max="1" step="0.1" value="0.5">
                            <small class="form-text text-muted">Severity: <span id="severity-value">0.5</span></small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-warning" id="inject-threat-confirm">
                        <i class="fas fa-bug me-2"></i>Inject Threat
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MTD Action Modal -->
    <div class="modal fade" id="mtdModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-shield-alt me-2"></i>Trigger MTD Action</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="mtd-form">
                        <div class="mb-3">
                            <label for="mtd-action" class="form-label">MTD Action</label>
                            <select class="form-select" id="mtd-action" required>
                                <option value="frequency_hopping">Frequency Hopping</option>
                                <option value="route_mutation">Route Mutation</option>
                                <option value="identity_rotation">Identity Rotation</option>
                                <option value="power_adjustment">Power Adjustment</option>
                                <option value="topology_shuffle">Topology Shuffle</option>
                                <option value="channel_switching">Channel Switching</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="mtd-nodes" class="form-label">Target Node IDs (comma-separated)</label>
                            <input type="text" class="form-control" id="mtd-nodes" placeholder="e.g., 1,2,3" required>
                        </div>
                        <div class="mb-3">
                            <label for="mtd-effectiveness" class="form-label">Expected Effectiveness (0.0 - 1.0)</label>
                            <input type="range" class="form-range" id="mtd-effectiveness" min="0" max="1" step="0.1" value="0.8">
                            <small class="form-text text-muted">Effectiveness: <span id="effectiveness-value">0.8</span></small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="trigger-mtd-confirm">
                        <i class="fas fa-shield-alt me-2"></i>Trigger MTD
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.26.0/plotly.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>

    <!-- Custom JavaScript -->
    <script>
        // Global variables
        let socket;
        let simulationData = {};
        let isConnected = false;
        let currentTab = 'overview';

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeSocket();
            initializeEventListeners();
            initializeTabs();
            startDataRefreshTimer();
        });

        // Socket.IO connection
        function initializeSocket() {
            socket = io();
            
            socket.on('connect', function() {
                isConnected = true;
                updateConnectionStatus(true);
                addLogEntry('Connected to server');
                socket.emit('request_update');
            });

            socket.on('disconnect', function() {
                isConnected = false;
                updateConnectionStatus(false);
                addLogEntry('Disconnected from server');
            });

            socket.on('simulation_status', function(data) {
                updateSimulationStatus(data);
            });

            socket.on('simulation_data', function(data) {
                simulationData = data;
                updateDashboard();
            });

            socket.on('simulation_update', function(data) {
                handleSimulationUpdate(data);
            });

            socket.on('database_data', function(data) {
                updateDatabaseCharts(data);
            });
        }

        // Event listeners
        function initializeEventListeners() {
            // Tab navigation
            document.querySelectorAll('[data-tab]').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    switchTab(this.dataset.tab);
                });
            });

            // Control buttons
            document.getElementById('start-sim-btn').addEventListener('click', startSimulation);
            document.getElementById('stop-sim-btn').addEventListener('click', stopSimulation);
            document.getElementById('export-results-btn').addEventListener('click', exportResults);
            
            // Modal buttons
            document.getElementById('inject-threat-confirm').addEventListener('click', injectThreat);
            document.getElementById('trigger-mtd-confirm').addEventListener('click', triggerMTD);
            
            // Range sliders
            document.getElementById('threat-severity').addEventListener('input', function() {
                document.getElementById('severity-value').textContent = this.value;
            });
            
            document.getElementById('mtd-effectiveness').addEventListener('input', function() {
                document.getElementById('effectiveness-value').textContent = this.value;
            });

            // Log management
            document.getElementById('clear-logs-btn').addEventListener('click', clearLogs);
            document.getElementById('download-logs-btn').addEventListener('click', downloadLogs);
        }

        // Tab management
        function initializeTabs() {
            // Hide all tab content except overview
            document.querySelectorAll('.tab-content').forEach(tab => {
                if (tab.id !== 'overview-tab') {
                    tab.style.display = 'none';
                }
            });
        }

        function switchTab(tabName) {
            // Update active tab
            document.querySelectorAll('[data-tab]').forEach(link => {
                link.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

            // Show/hide content
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            document.getElementById(`${tabName}-tab`).style.display = 'block';

            currentTab = tabName;
            
            // Refresh data for the new tab
            refreshCurrentTab();
        }

        // Connection status
        function updateConnectionStatus(connected) {
            const indicator = document.getElementById('connection-indicator');
            const text = document.getElementById('connection-text');
            
            if (connected) {
                indicator.className = 'status-indicator online';
                text.textContent = 'Connected';
            } else {
                indicator.className = 'status-indicator offline';
                text.textContent = 'Disconnected';
            }
        }

        // Update simulation status
        function updateSimulationStatus(status) {
            document.getElementById('total-nodes').textContent = status.nodes?.total || 0;
            document.getElementById('compromised-nodes').textContent = status.nodes?.compromised || 0;
            document.getElementById('total-threats').textContent = status.threats?.total || 0;
            document.getElementById('mtd-actions').textContent = status.mtd_actions?.total || 0;
        }

        // Handle simulation updates
        function handleSimulationUpdate(data) {
            if (data.type === 'simulation_update') {
                simulationData = data.data;
                updateDashboard();
                addLogEntry(`Simulation update received: ${JSON.stringify(data.data).substring(0, 100)}...`);
            }
        }

        // Update dashboard
        function updateDashboard() {
            switch (currentTab) {
                case 'overview':
                    updateOverviewCharts();
                    break;
                case 'network':
                    updateNetworkTab();
                    break;
                case 'threats':
                    updateThreatsTab();
                    break;
                case 'mtd':
                    updateMTDTab();
                    break;
            }
        }

        // Chart updates
        function updateOverviewCharts() {
            // Update charts with current data
            if (simulationData.nodes) {
                updateNetworkHealthChart();
                updateEnergyLevelsChart();
            }
            
            if (simulationData.threats) {
                updateThreatTimelineChart();
            }
            
            if (simulationData.mtd_actions) {
                updateMTDEffectivenessChart();
            }
        }

        function updateNetworkHealthChart() {
            fetch('/api/charts/network_health')
                .then(response => response.json())
                .then(data => {
                    Plotly.newPlot('network-health-chart', data.data, data.layout, {responsive: true});
                })
                .catch(error => console.error('Error updating network health chart:', error));
        }

        function updateThreatTimelineChart() {
            fetch('/api/charts/threat_timeline')
                .then(response => response.json())
                .then(data => {
                    Plotly.newPlot('threat-timeline-chart', data.data, data.layout, {responsive: true});
                })
                .catch(error => console.error('Error updating threat timeline chart:', error));
        }

        function updateEnergyLevelsChart() {
            fetch('/api/charts/energy_levels')
                .then(response => response.json())
                .then(data => {
                    Plotly.newPlot('energy-levels-chart', data.data, data.layout, {responsive: true});
                })
                .catch(error => console.error('Error updating energy levels chart:', error));
        }

        function updateMTDEffectivenessChart() {
            fetch('/api/charts/mtd_effectiveness')
                .then(response => response.json())
                .then(data => {
                    Plotly.newPlot('mtd-effectiveness-chart', data.data, data.layout, {responsive: true});
                })
                .catch(error => console.error('Error updating MTD effectiveness chart:', error));
        }

        // Network tab updates
        function updateNetworkTab() {
            updateNetworkTopologyChart();
            updateNodesTable();
            updateNetworkStats();
        }

        function updateNetworkTopologyChart() {
            fetch('/api/charts/network_topology')
                .then(response => response.json())
                .then(data => {
                    Plotly.newPlot('network-topology-chart', data.data, data.layout, {responsive: true});
                })
                .catch(error => console.error('Error updating network topology chart:', error));
        }

        function updateNodesTable() {
            const tbody = document.querySelector('#nodes-table tbody');
            tbody.innerHTML = '';
            
            if (simulationData.nodes) {
                simulationData.nodes.forEach(node => {
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${node.id}</td>
                        <td><span class="badge bg-info">${node.type}</span></td>
                        <td>${node.is_compromised ? '<span class="badge bg-danger">Compromised</span>' : '<span class="badge bg-success">Healthy</span>'}</td>
                        <td>
                            <div class="progress" style="height: 20px;">
                                <div class="progress-bar ${node.energy_level < 0.2 ? 'bg-danger' : node.energy_level < 0.5 ? 'bg-warning' : 'bg-success'}" 
                                     style="width: ${node.energy_level * 100}%">${(node.energy_level * 100).toFixed(1)}%</div>
                            </div>
                        </td>
                        <td>${node.position ? `(${node.position[0].toFixed(1)}, ${node.position[1].toFixed(1)}, ${node.position[2].toFixed(1)})` : 'N/A'}</td>
                    `;
                });
            }
        }

        function updateNetworkStats() {
            // Update network statistics
            const pdr = Math.random() * 100; // Placeholder
            const throughput = Math.random() * 1000; // Placeholder
            
            document.getElementById('pdr-progress').style.width = `${pdr}%`;
            document.getElementById('pdr-text').textContent = `${pdr.toFixed(1)}%`;
            
            document.getElementById('throughput-progress').style.width = `${throughput / 10}%`;
            document.getElementById('throughput-text').textContent = `${throughput.toFixed(0)} kbps`;
            
            document.getElementById('latency-text').textContent = `${(Math.random() * 100).toFixed(0)} ms`;
            document.getElementById('connections-text').textContent = simulationData.nodes ? simulationData.nodes.length : 0;
        }

        // Threats tab updates
        function updateThreatsTab() {
            updateThreatsTable();
        }

        function updateThreatsTable() {
            const tbody = document.querySelector('#threats-table tbody');
            tbody.innerHTML = '';
            
            if (simulationData.threats) {
                simulationData.threats.forEach(threat => {
                    const row = tbody.insertRow();
                    const severity = threat.severity || 0.5;
                    const severityClass = severity > 0.7 ? 'danger' : severity > 0.4 ? 'warning' : 'info';
                    
                    row.innerHTML = `
                        <td>${new Date(threat.timestamp).toLocaleTimeString()}</td>
                        <td><span class="badge bg-${severityClass}">${threat.type}</span></td>
                        <td>${threat.source_node}</td>
                        <td>${threat.target_node}</td>
                        <td>
                            <div class="progress" style="height: 20px;">
                                <div class="progress-bar bg-${severityClass}" style="width: ${severity * 100}%">${(severity * 100).toFixed(0)}%</div>
                            </div>
                        </td>
                        <td>${threat.detected ? '<span class="badge bg-success">Detected</span>' : '<span class="badge bg-secondary">Undetected</span>'}</td>
                    `;
                });
            }
        }

        // MTD tab updates
        function updateMTDTab() {
            updateMTDTable();
        }

        function updateMTDTable() {
            const tbody = document.querySelector('#mtd-table tbody');
            tbody.innerHTML = '';
            
            if (simulationData.mtd_actions) {
                simulationData.mtd_actions.forEach(action => {
                    const row = tbody.insertRow();
                    const effectiveness = action.effectiveness || 0.8;
                    
                    row.innerHTML = `
                        <td>${new Date(action.timestamp).toLocaleTimeString()}</td>
                        <td><span class="badge bg-primary">${action.action}</span></td>
                        <td>${Array.isArray(action.target_nodes) ? action.target_nodes.join(', ') : action.target_node}</td>
                        <td>
                            <div class="progress" style="height: 20px;">
                                <div class="progress-bar bg-success" style="width: ${effectiveness * 100}%">${(effectiveness * 100).toFixed(0)}%</div>
                            </div>
                        </td>
                        <td>${action.cost ? action.cost.toFixed(2) : 'N/A'}</td>
                        <td>${action.success ? '<span class="badge bg-success">Success</span>' : '<span class="badge bg-danger">Failed</span>'}</td>
                    `;
                });
            }
        }

        // Control functions
        function startSimulation() {
            const params = {
                duration: parseInt(document.getElementById('duration').value),
                num_drones: parseInt(document.getElementById('drones').value),
                num_honeypots: parseInt(document.getElementById('honeypots').value),
                attack_scenario: document.getElementById('attack-scenario').value
            };
            
            fetch('/api/control/start_simulation', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(params)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    addLogEntry('Simulation started successfully');
                    showToast('Success', 'Simulation started', 'success');
                } else {
                    addLogEntry('Failed to start simulation');
                    showToast('Error', 'Failed to start simulation', 'error');
                }
            })
            .catch(error => {
                addLogEntry(`Error starting simulation: ${error}`);
                showToast('Error', 'Network error', 'error');
            });
        }

        function stopSimulation() {
            fetch('/api/control/stop_simulation', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'}
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    addLogEntry('Simulation stopped successfully');
                    showToast('Success', 'Simulation stopped', 'success');
                } else {
                    addLogEntry('Failed to stop simulation');
                    showToast('Error', 'Failed to stop simulation', 'error');
                }
            })
            .catch(error => {
                addLogEntry(`Error stopping simulation: ${error}`);
                showToast('Error', 'Network error', 'error');
            });
        }

        function injectThreat() {
            const params = {
                threat_type: document.getElementById('threat-type').value,
                source_node: parseInt(document.getElementById('source-node').value),
                target_node: parseInt(document.getElementById('target-node').value),
                severity: parseFloat(document.getElementById('threat-severity').value)
            };
            
            fetch('/api/control/inject_threat', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(params)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    addLogEntry(`Threat injected: ${params.threat_type} from node ${params.source_node} to ${params.target_node}`);
                    showToast('Success', 'Threat injected successfully', 'warning');
                    bootstrap.Modal.getInstance(document.getElementById('threatModal')).hide();
                } else {
                    addLogEntry('Failed to inject threat');
                    showToast('Error', 'Failed to inject threat', 'error');
                }
            })
            .catch(error => {
                addLogEntry(`Error injecting threat: ${error}`);
                showToast('Error', 'Network error', 'error');
            });
        }

        function triggerMTD() {
            const nodeIds = document.getElementById('mtd-nodes').value.split(',').map(id => parseInt(id.trim()));
            const params = {
                action: document.getElementById('mtd-action').value,
                target_nodes: nodeIds,
                effectiveness: parseFloat(document.getElementById('mtd-effectiveness').value)
            };
            
            fetch('/api/control/trigger_mtd', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(params)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    addLogEntry(`MTD action triggered: ${params.action} on nodes ${nodeIds.join(', ')}`);
                    showToast('Success', 'MTD action triggered successfully', 'success');
                    bootstrap.Modal.getInstance(document.getElementById('mtdModal')).hide();
                } else {
                    addLogEntry('Failed to trigger MTD action');
                    showToast('Error', 'Failed to trigger MTD action', 'error');
                }
            })
            .catch(error => {
                addLogEntry(`Error triggering MTD: ${error}`);
                showToast('Error', 'Network error', 'error');
            });
        }

        function exportResults() {
            fetch('/api/export_results')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    addLogEntry(`Results exported to: ${data.export_file}`);
                    showToast('Success', 'Results exported successfully', 'success');
                } else {
                    addLogEntry('Failed to export results');
                    showToast('Error', 'Failed to export results', 'error');
                }
            })
            .catch(error => {
                addLogEntry(`Error exporting results: ${error}`);
                showToast('Error', 'Network error', 'error');
            });
        }

        // Utility functions
        function addLogEntry(message) {
            const logContainer = document.getElementById('log-container');
            const timestamp = new Date().toISOString().slice(11, 19);
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `<span class="timestamp">[${timestamp}]</span><span class="log-message">${message}</span>`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function clearLogs() {
            document.getElementById('log-container').innerHTML = '';
            addLogEntry('Logs cleared');
        }

        function downloadLogs() {
            const logs = document.getElementById('log-container').innerText;
            const blob = new Blob([logs], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `fanet_logs_${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function showToast(title, message, type) {
            // Create toast element
            const toastHtml = `
                <div class="toast align-items-center text-white bg-${type === 'success' ? 'success' : type === 'warning' ? 'warning' : 'danger'} border-0" role="alert">
                    <div class="d-flex">
                        <div class="toast-body">
                            <strong>${title}:</strong> ${message}
                        </div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                    </div>
                </div>
            `;
            
            // Add to toast container
            const toastContainer = document.querySelector('.toast-container');
            toastContainer.insertAdjacentHTML('beforeend', toastHtml);
            
            // Show toast
            const toastElement = toastContainer.lastElementChild;
            const toast = new bootstrap.Toast(toastElement);
            toast.show();
            
            // Remove toast element after hiding
            toastElement.addEventListener('hidden.bs.toast', () => {
                toastElement.remove();
            });
        }

        function refreshCurrentTab() {
            switch (currentTab) {
                case 'overview':
                    updateOverviewCharts();
                    break;
                case 'network':
                    updateNetworkTab();
                    break;
                case 'threats':
                    updateThreatsTab();
                    break;
                case 'mtd':
                    updateMTDTab();
                    break;
            }
        }

        function startDataRefreshTimer() {
            // Refresh data every 5 seconds
            setInterval(() => {
                if (isConnected) {
                    socket.emit('request_update');
                }
            }, 5000);

            // Refresh charts every 10 seconds
            setInterval(() => {
                if (isConnected && currentTab === 'overview') {
                    updateOverviewCharts();
                }
            }, 10000);
        }

        function updateDatabaseCharts(data) {
            // Update charts with database data
            if (data.threats && data.threats.length > 0) {
                updateThreatDistributionChart(data.threats);
                updateThreatHeatmapChart(data.threats);
            }
            
            if (data.mtd_actions && data.mtd_actions.length > 0) {
                updateMTDPerformanceChart(data.mtd_actions);
            }
        }

        function updateThreatDistributionChart(threats) {
            const threatCounts = {};
            threats.forEach(threat => {
                threatCounts[threat.type] = (threatCounts[threat.type] || 0) + 1;
            });

            const data = [{
                values: Object.values(threatCounts),
                labels: Object.keys(threatCounts),
                type: 'pie',
                hole: 0.4,
                marker: {
                    colors: ['#e74c3c', '#f39c12', '#9b59b6', '#3498db', '#1abc9c']
                }
            }];

            const layout = {
                title: 'Threat Type Distribution',
                font: { size: 12 },
                showlegend: true,
                margin: { t: 50, b: 20, l: 20, r: 20 }
            };

            Plotly.newPlot('threat-distribution-chart', data, layout, {responsive: true});
        }

        function updateThreatHeatmapChart(threats) {
            // Create adjacency matrix for threat heatmap
            const nodes = new Set();
            threats.forEach(threat => {
                nodes.add(threat.source_node);
                nodes.add(threat.target_node);
            });

            const nodeList = Array.from(nodes).sort((a, b) => a - b);
            const matrix = Array(nodeList.length).fill().map(() => Array(nodeList.length).fill(0));

            threats.forEach(threat => {
                const sourceIdx = nodeList.indexOf(threat.source_node);
                const targetIdx = nodeList.indexOf(threat.target_node);
                if (sourceIdx !== -1 && targetIdx !== -1) {
                    matrix[sourceIdx][targetIdx]++;
                }
            });

            const data = [{
                z: matrix,
                x: nodeList,
                y: nodeList,
                type: 'heatmap',
                colorscale: 'Reds',
                showscale: true
            }];

            const layout = {
                title: 'Threat Interaction Heatmap',
                xaxis: { title: 'Target Node' },
                yaxis: { title: 'Source Node' },
                font: { size: 12 }
            };

            Plotly.newPlot('threat-heatmap-chart', data, layout, {responsive: true});
        }

        function updateMTDPerformanceChart(mtdActions) {
            const actionTypes = {};
            mtdActions.forEach(action => {
                if (!actionTypes[action.action]) {
                    actionTypes[action.action] = { effectiveness: [], cost: [], success: 0, total: 0 };
                }
                actionTypes[action.action].effectiveness.push(action.effectiveness);
                actionTypes[action.action].cost.push(action.cost);
                actionTypes[action.action].total++;
                if (action.success) {
                    actionTypes[action.action].success++;
                }
            });

            const data = [{
                x: Object.keys(actionTypes),
                y: Object.keys(actionTypes).map(action => {
                    const avg = actionTypes[action].effectiveness.reduce((a, b) => a + b, 0) / actionTypes[action].effectiveness.length;
                    return avg * 100;
                }),
                type: 'bar',
                marker: {
                    color: Object.keys(actionTypes).map(action => {
                        const successRate = actionTypes[action].success / actionTypes[action].total;
                        return successRate > 0.8 ? '#27ae60' : successRate > 0.6 ? '#f39c12' : '#e74c3c';
                    })
                }
            }];

            const layout = {
                title: 'MTD Action Effectiveness',
                xaxis: { title: 'MTD Action Type' },
                yaxis: { title: 'Average Effectiveness (%)' },
                font: { size: 12 },
                margin: { t: 50, b: 100, l: 50, r: 20 }
            };

            Plotly.newPlot('mtd-performance-chart', data, layout, {responsive: true});
        }

        // Initialize page
        addLogEntry('Dashboard loading...');
        addLogEntry('Initializing WebSocket connection...');
    </script>
</body>
</html>